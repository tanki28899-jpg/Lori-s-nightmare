-- НАСТРОЙКИ
local BASE_SPEED = 50
local SPEED_STEP = 10

-- СЕРВИСЫ
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local root = character:WaitForChild("HumanoidRootPart")
local camera = workspace.CurrentCamera

-- ПЕРЕМЕННЫЕ
local flying = false
local speed = BASE_SPEED
local keys = {}

-- BODY OBJECTS
local bodyVelocity = Instance.new("BodyVelocity")
bodyVelocity.MaxForce = Vector3.new(1e9, 1e9, 1e9)

local bodyGyro = Instance.new("BodyGyro")
bodyGyro.MaxTorque = Vector3.new(1e9, 1e9, 1e9)
bodyGyro.P = 10000

-- ВКЛ / ВЫКЛ ПОЛЁТА
local function toggleFly()
	flying = not flying

	if flying then
		humanoid.PlatformStand = true
		bodyVelocity.Parent = root
		bodyGyro.Parent = root
	else
		humanoid.PlatformStand = false
		bodyVelocity.Parent = nil
		bodyGyro.Parent = nil
	end
end

-- НАЖАТИЯ КЛАВИШ
UserInputService.InputBegan:Connect(function(input, gpe)
	if gpe then return end

	keys[input.KeyCode] = true

	if input.KeyCode == Enum.KeyCode.F then
		toggleFly()
	elseif input.KeyCode == Enum.KeyCode.Equals then
		speed += SPEED_STEP
	elseif input.KeyCode == Enum.KeyCode.Minus then
		speed = math.max(10, speed - SPEED_STEP)
	end
end)

UserInputService.InputEnded:Connect(function(input)
	keys[input.KeyCode] = false
end)

-- ОСНОВНОЙ ЦИКЛ
RunService.RenderStepped:Connect(function()
	if not flying then return end

	local direction = Vector3.zero

	if keys[Enum.KeyCode.W] then direction += camera.CFrame.LookVector end
	if keys[Enum.KeyCode.S] then direction -= camera.CFrame.LookVector end
	if keys[Enum.KeyCode.A] then direction -= camera.CFrame.RightVector end
	if keys[Enum.KeyCode.D] then direction += camera.CFrame.RightVector end
	if keys[Enum.KeyCode.Space] then direction += Vector3.new(0, 1, 0) end
	if keys[Enum.KeyCode.LeftControl] then direction -= Vector3.new(0, 1, 0) end

	if direction.Magnitude > 0 then
		direction = direction.Unit
	end

	bodyVelocity.Velocity = direction * speed
	bodyGyro.CFrame = camera.CFrame
end)
